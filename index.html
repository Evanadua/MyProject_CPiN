<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>ConsPIndo - Consortium Pioneers Indonesia</title>
 
   <link rel="stylesheet" href="style.css">
   <!-- Custom JavaScript -->
  
  <!-- External CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />


     <!-- External Scripts -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  
  <!-- Firebase v9 SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- Pi Network SDK (versi 2.0 resmi) -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
  window.Pi.init({ version: "2.0", sandbox: false });

  const ua = navigator.userAgent || "";
  const isPiBrowser = ua.includes("PiBrowser");

  function piLogin(){
    if(!window.Pi){
      alert("Fitur Pi hanya tersedia di dalam Pi Browser.");
      return;
    }
    window.Pi.authenticate(["username"], function(auth, error){
      if(error){
        console.error("Autentikasi Pi gagal:", error);
        return;
      }
      console.log("User Pi:", auth);
      document.getElementById("loginStatus").innerText =
        "Login Pi berhasil: " + auth.user.username;
    });
  }

  function appLogin(){
    if(typeof showLoginModal === 'function') showLoginModal();
    else if(typeof showAuthModal === 'function') showAuthModal(false);
  }

  function appRegister(){
    if(typeof showRegisterModal === 'function') showRegisterModal();
    else if(typeof showAuthModal === 'function') showAuthModal(true);
  }

  document.addEventListener("DOMContentLoaded", function(){
    const menu = document.getElementById("loginMenu");
    if(menu){
      menu.innerHTML = `
        <select id="loginSelect" style="font-size:0.85em;padding:4px 10px;border-radius:22px;border:1px solid #ccc;background:#fff;cursor:pointer;">
          <option value="">Pilih Login</option>
          <option value="pi">Login Pi</option>
          <option value="app">Login App</option>
          <option value="register">Register App</option>
        </select>
      `;

      document.getElementById("loginSelect").addEventListener("change", function(){
        if(this.value === "pi"){
          piLogin();
        } else if(this.value === "app"){
          appLogin();
        } else if(this.value === "register"){
          appRegister();
        }
        this.value = "";
      });
    }
  });
</script>


<body>
  <!-- Header Slider -->
  <div id="header-slider">
    <img src="https://raw.githubusercontent.com/Evanadua/MyProject_CPiN/refs/heads/main/assets/images/header1.jpg" class="slide" alt="Header Slide 1" />
    <img src="https://raw.githubusercontent.com/Evanadua/MyProject_CPiN/refs/heads/main/assets/images/header2.jpg" class="slide" alt="Header Slide 2" />
    <img src="https://raw.githubusercontent.com/Evanadua/MyProject_CPiN/refs/heads/main/assets/images/header3.jpg" class="slide" alt="Header Slide 3" />
  </div>

<script>
 	// JS placeholder

function startHeaderSlider() {
  const slides = document.querySelectorAll('#header-slider .slide');
  let index = 0;
  if (slides.length === 0) return;

  slides[index].classList.add('active');

  setInterval(() => {
    slides[index].classList.remove('active');
    index = (index + 1) % slides.length;
    slides[index].classList.add('active');
  }, 4000);
}

document.addEventListener("DOMContentLoaded", function () {
  startHeaderSlider();
});
</script>

  <!-- Header Section 
  <div class="header-wrap">
    <img alt="Header Background" class="header-bg" id="headerBg" src="https://raw.githubusercontent.com/Evanadua/MyProject_CPiN/refs/heads/main/img_header.png"/>
    <button class="header-bg-upload" onclick="document.getElementById('headerBgInput').click()">
      Ganti Gambar Header
    </button>
    <input accept="image/*" id="headerBgInput" onchange="changeHeaderBg(event)" style="display:none" type="file"/>
    <div class="header">
      <div class="header-row">
        <div class="header-logo-wrap">
          <img alt="Logo ConsPiSindo" class="header-logo" id="logoImg" src="https://raw.githubusercontent.com/Evanadua/MyProject_CPiN/refs/heads/main/logo.png"/>
          <button class="header-logo-upload" onclick="document.getElementById('logoInput').click()">
            Ganti Logo
          </button>
          <input accept="image/*" id="logoInput" onchange="changeLogo(event)" style="display:none" type="file"/>
        </div>
        -->
        <div class="header-content">
          <div class="header-title">ConsPIndo</div>
          <div class="header-desc">Consortium Pioneers Indonesia</div>
          <div class="header-info">
           <span id="memberCount">1 Member</span>
            &middot;
            <span>General Info</span>
          </div>
        </div>
        <div class="header-btns">
          <button class="invite" id="inviteBtn">Invite</button>
          <button id="buyNowBtn">Buy Now</button>
          <div id="loginMenu"></div>
        </div>
      </div>
    </div>
    <div style="clear:both;"></div>
  </div>
          
  <!-- â¬‡ Avatar kanan -->
  <div id="userAvatarContainer">
    <img id="userAvatar" src="" alt="Foto Profil" />
    <div id="userTooltip"></div>
  </div>
</div>

  <!-- Tab Menu -->
  <div class="tab-menu">
    <button class="active" id="homeTab">Home</button>
    <button id="scheduleTab">Schedule</button>
    <button id="servicesTab">Services</button>
    <button id="blogTab">Blog</button>
  </div>
  
<div id="adminMemberList"></div>
 <!-- Harus ada 
   <button class="btn" id="adminMenuBtn" style="display:none;margin:8px 0;">Admin Panel</button> 
  -->
  <!-- Auth Modal -->
  <div class="modal" id="authModal" style="display:none;">
    <div class="modal-content" style="max-width:400px;">
      <span class="close" onclick="closeModal('authModal')">&times;</span>
      <h2 style="text-align:center;margin-top:0;">Registrasi / Login</h2>
      <div id="authTabs" style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;">
        <button class="btn" id="tabLogin" style="background:#2563eb;color:#fff;">Login</button>
        <button class="btn" id="tabRegister" style="background:#eee;color:#2563eb;">Registrasi</button>
      </div>
      <form id="loginForm">
        <input id="loginEmail" placeholder="Email" style="width:100%;margin-bottom:8px;" type="email"/>
        <input id="loginPassword" placeholder="Password" style="width:100%;margin-bottom:8px;" type="password"/>
         <button class="btn" id="loginBtn" type="button">Login</button>
      </form>
      <form id="registerForm" style="display:none;">
        <input id="regEmail" placeholder="Email" style="width:100%;margin-bottom:8px;" type="email"/>
        <input id="regPassword" placeholder="Password" style="width:100%;margin-bottom:8px;" type="password"/>
        <input id="regPassword2" placeholder="Konfirmasi Password" style="width:100%;margin-bottom:8px;" type="password"/>
        <button class="btn" id="registerBtn" type="button">Register</button>
      </form>
      <div id="authError" style="color:red;margin-top:10px;display:none;"></div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div id="pageContent"></div>
    
    <!-- Modal untuk Artikel Lengkap -->
    <div id="fullArticleModal">
      <button onclick="closeFullArticle()" style="float: right; background: #f00; color: #fff; border: none; padding: 5px 10px; cursor: pointer;">X</button>
      <h4 id="fullArticleTitle"></h4>
      <p id="fullArticleBody"></p>
    </div>
  </div>

  <!-- Floating Action Button -->
  <div class="fab" id="adminFabBtn" style="display: none;" onclick="showAdminPanel()">
    <i class="fa fa-cog"></i>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
   <a class="nav-item active" href="#" id="legalMenu">
  <i class="fa fa-gavel"></i>
  <span>Legal</span>
</a>
    <a class="nav-item" href="#" id="groupMenu">
      <i class="fa fa-comments"></i>
      <span>Group</span>
    </a>
    <a class="nav-item" href="#" id="shopMenu">
      <i class="fa fa-store"></i>
      <span>Shop</span>
    </a>
    <a class="nav-item" href="#" id="myProfileMenu">
      <i class="fa fa-user"></i>
      <span>My Profile</span>
    </a>
  </div>

  <!-- Modals -->
  <div class="modal" id="inviteModal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('inviteModal')">&times;</span>
      <h3>Undang Teman ke Group</h3>
      <p>Bagikan kode invite: <b id="groupInviteCodeModal">2QQ32Y</b></p>
      <button onclick="copyGroupInviteCode()">Salin Kode</button>
    </div>
  </div>
<div class="modal" id="groupModal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('groupModal')">&times;</span>
      <h3>Group Chat</h3>
      <div id="groupChatList"></div>
      <button class="btn" onclick="openGroupChat()">Buka Group Chat</button>
      <span class="chat-username" id="groupChatUsername"></span>
    </div>
  </div>
  <div class="main-content">
  <div id="adminPanel" style="display:none;">
    <h2>Admin Panel</h2>
    <div class="btn-row">
      <button class="btn" onclick="showAddProductForm()">Tambah Produk</button>
      <button class="btn" onclick="showManualProductForm()">Tambah Produk Manual</button>
      <button class="btn" onclick="showMyProfile()">My Profile</button>
      <button class="btn" onclick="showServices()">Layanan Kami</button>
      <button class="btn" onclick="showLegal()">Legal</button>
      <button class="btn" onclick="showShop()">Shop</button>
      <button class="btn btn-danger" onclick="resetAllMembers()">Reset All Members</button>
    </div>
    <div id="adminShopBtns" class="admin-panel" style="margin-bottom:16px;"></div>
    <div id="shopProducts"></div> <!-- Ini perlu agar renderShopProducts bekerja -->
  <!-- Tempat form tambah produk -->
     <div id="addProductManualForm" style="display:none; margin-top: 20px;"></div>
    <div id="addProductForm" style="display:none;">
    <h3>Tambah Produk</h3>
    <input id="productName" placeholder="Nama Produk" style="width:100%;margin-bottom:8px;" type="text"/>
    <input id="productPrice" placeholder="Harga" style="width:100%;margin-bottom:8px;" type="number"/>
    <textarea id="productDescription" placeholder="Deskripsi Produk" style="width:100%;margin-bottom:8px;"></textarea>
    <input id="productImageUrl" placeholder="URL Gambar Produk" style="width:100%;margin-bottom:8px;" type="text"/>
    <button class="btn" onclick="addProduct()">Tambah Produk</button>
  </div>
  <!--
  <div id="myProfileContent" style="display:none;">
    <h2>My Profile</h2>
    <div id="profileDetails"></div>
    <button class="btn" onclick="openMyProfileModal()">Edit Profile</button>
    <button class="btn" onclick="openChangePwdModal()">Ganti Password</button>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
   <div class="modal" id="myProfileEditContainer" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('myProfileEditModal')">&times;</span>
      <h3>Edit Profile</h3>
      <input id="editProfileName" placeholder="Nama Lengkap" style="width:100%;margin-bottom:8px;" type="text"/>
      <input id="editProfileEmail" placeholder="Email" style="width:100%;margin-bottom:8px;" type="email"/>
      <button class="btn" onclick="saveProfileChanges()">Simpan Perubahan</button>
    </div>
  </div>

--><!-- === MODAL: MY PROFILE === -->
<div class="modal" id="myProfileModal" style="display:none;">
  <div class="modal-content" style="max-width:400px; margin:auto;">
    <span class="close" onclick="closeMyProfileModal()">&times;</span>
    <h3 style="text-align:center;">Profil Saya</h3>

    <!-- Foto Profil -->
    <div style="text-align:center;margin-bottom:12px;">
      <img id="profilePhoto" src="" alt="Foto Profil" width="100" height="100"
           style="border-radius:50%;border:1px solid #ccc;object-fit:cover;"><br>
      <label for="profilePhotoInputLocal" style="display:inline-block;margin-top:6px;">
        Ganti Foto Profil:
      </label><br>
      <input type="file" id="profilePhotoInputLocal" accept="image/*">
    </div>        
    <button class="btn" onclick="openMyProfileModal()">My Profile</button>

    
  <div class="form-group">
    <label for="profileUsername">Nama Pengguna</label>
    <input type="text" id="profileUsername" class="form-control" placeholder="Nama pengguna">
  </div>

  <div class="form-group">
    <label for="profileEmail">Email</label>
    <input type="email" id="profileEmail" class="form-control" placeholder="Email">
  </div>

  <div class="form-group">
    <label for="profilePhone">Nomor HP</label>
    <input type="tel" id="profilePhone" class="form-control" placeholder="Nomor Telepon">
  </div>

  <div style="margin-top:10px;text-align:right;">
    <button class="btn" onclick="saveProfile()">Simpan Profil</button>
    <button class="btn btn-danger" onclick="logoutUser()">Logout</button>
  </div>
  <div id="authError" style="display:none;margin-top:10px;"></div>
</div>


<!-- === MODAL SERVICES === --><!-- ========== HALAMAN DAFTAR LAYANAN ========== -->
<div id="serviceList"></div>
<div id="serviceDetailContent"></div>
<div style="margin-top:10px;">
  <button id="adminLoginBox" class="btn" onclick="serviceAdminLogin()">Login Admin</button>
  <button id="adminLogoutBox" class="btn" onclick="serviceAdminLogout()" style="display:none;">Logout Admin</button>
</div>


<!-- === MODAL HOME DropDownMenu === -->
 
  <!-- âœ… BAGIAN POSTINGAN USER -->
  <div id="userPostCard" style="margin: 20px 0;"></div>

 

<div class="page" id="page-blog" style="display:none;">
  <div id="blogPosts"></div>
</div>


  <div class="page" id="page-home" style="display:none;"></div>
  <div class="page" id="page-login" style="display:none;"></div>
  <div class="page" id="page-schedule" style="display:none;"></div>
  <div class="page" id="page-shop" style="display:none;"></div>
  <div class="page" id="page-legal" style="display:none;"></div>
  <div class="page" id="page-my-profile" style="display:none;"></div>
  <div class="page" id="page-group-chat" style="display:none;"></div>
  <div class="page" id="page-admin-panel" style="display:none;"></div>
  <div class="page" id="page-event-add" style="display:none;"></div>
  <div class="page" id="page-event-edit" style="display:none;"></div>
  <div class="page" id="page-full-article" style="display:none;"></div>
  <div class="page" id="page-invite" style="display:none;"></div>
  <div class="page" id="page-change-password" style="display:none;"></div>
  <div class="page" id="page-cart" style="display:none;"></div>
  <div class="page" id="page-product-detail" style="display:none;"></div>
  <div class="page" id="page-group-list" style="display:none;"></div>
  <div class="page" id="page-group-chat-modal" style="display:none;"></div>
  <div class="page" id="page-legal-content" style="display:none;"></div>
  <div class="page" id="page-shop-content" style="display:none;"></div>
  <div class="page" id="page-blog-content" style="display:none;"></div>
  <div class="page" id="page-schedule-content" style="display:none;"></div>
  <div class="page" id="page-page-content" style="display:none;"></div>
  <div class="page" id="page-product-detail-modal" style="display:none;"></div>
  <div class="page" id="page-group-chat-list" style="display:none;"></div>
  <div class="page" id="page-group-chat-modal-content" style="display:none;"></div>
  <div class="page" id="page-invite-modal" style="display:none;"></div>
  <div class="page" id="page-change-password-modal" style="display:none;"></div>
  <div class="page" id="page-cart-modal" style="display:none;"></div>
  <div class="page" id="page-product-detail-modal-content" style="display:none;"></div>
  <div class="page" id="page-group-list-modal" style="display:none;"></div>
  <div class="page" id="page-group-chat-modal-content" style="display:none;"></div>
  <div class="page" id="page-legal-content-modal" style="display:none;"></div>

  <div id="shopContent" style="display:none;">
    <h2>Shop</h2>
    <div id="shopProductsList"></div>
    <button class="btn" onclick="loadMoreProducts()">Lihat Semua Produk</button>
    </div>
  
  <div id="blogContent" style="display:none;">
    <h2>Blog</h2>
    <div id="blogPosts"></div>
    <button class="btn" onclick="loadMoreBlogPosts()">Load More</button>
  </div>
  <div id="scheduleContent" style="display:none;">
    <h2>Jadwal Kegiatan</h2>
    <div id="calendar"></div>
  </div>
  <div id="pageContent"></div>
  </div>
</div>

  <div class="modal" id="shopModal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('shopModal')">&times;</span>
      <h3>Shop</h3>
      <div id="shopProductsList"></div>
      <button class="btn" onclick="openCart()">Keranjang Belanja</button>
    </div>
  </div>
  <div class="modal" id="buyNowModal" style="display:none;">
    <div class="modal-content" id="buyNowContent" style="max-width:350px;">
     <span class="close" onclick="closeModal('buyNowModal')">&times;</span>
      <h3>Pesan Sekarang</h3>
      <p>Silakan isi detail pesanan Anda:</p>
      <input id="buyerNameCheckout" placeholder="Nama Anda" style="width:100%;margin-bottom:8px;" type="text"/>
      <input id="buyerAddressCheckout" placeholder="Alamat Pengiriman" style="width:100%;margin-bottom:8px;" type="text"/>
      <button class="btn" onclick="processOrder()">Proses Pesanan</button>
    </div>
  </div>

<div class="modal" id="cartModal" style="display:none;">
  <div class="modal-content" style="max-width:400px;">
    <span class="close" onclick="closeModal('cartModal')">&times;</span>
    <h3>Keranjang Belanja</h3>
    <div id="cartItems"></div>
    <button class="btn" onclick="checkout()">Checkout</button>
  </div>
</div><!-- Modal Detil Produk -->
<div id="productDetailModal" class="modal" style="display:none;">
  <div class="modal-content" id="productDetailContent" style="max-width:400px;">
    <!-- Konten akan dimuat dari JS -->
  </div>
</div>
<!-- === GROUP SECTION WITH CHAT === -->
<div id="groupList" class="group-list"></div>

<!-- === GROUP CHAT MODAL === -->
<div class="modal" id="groupChatModal" style="display:none;">
  <div class="modal-content" style="max-width:400px;">
    <span class="close" onclick="closeModal('groupChatModal')">&times;</span>
    <h3 id="groupChatTitle">Group Chat</h3>
    <div id="groupChatMessages" style="height:320px;overflow:auto;border:1px solid #eee;padding:8px 6px 8px 6px;margin-bottom:10px;background:#f9f9f9;border-radius:6px;"></div>
    <input id="groupChatInput" placeholder="Ketik pesan..." style="width:70%;" type="text"/>
    <button class="btn" onclick="sendGroupChat()">Kirim</button>
  </div>
</div>
<style>
  #groupChatMessages div {
    margin-bottom: 6px;
    font-size: 14px;
    line-height: 1.4;
  }
</style>

  <div class="modal" id="changePwdModal" style="display:none;">
    <div class="modal-content" style="max-width:350px;">
      <span class="close" onclick="closeModal('changePwdModal')">&times;</span>
      <h3>Ganti Password Admin</h3>
      <input type="password" id="oldPwd" placeholder="Password Lama" style="width:100%;margin-bottom:8px;">
      <input type="password" id="newPwd" placeholder="Password Baru" style="width:100%;margin-bottom:8px;">
      <input type="password" id="confirmPwd" placeholder="Ulangi Password Baru" style="width:100%;margin-bottom:8px;">
      <button class="btn" onclick="changeAdminPassword()">Simpan</button>
    </div>
  </div>
  <!-- === EVENT ADD MODAL === -->
<div class="modal" id="eventAddModal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeModal('eventAddModal')">&times;</span>
    <h3 id="modalTitleAdd">Tambah Event</h3>
    <input type="hidden" id="eventAddId">
    <input type="text" id="eventAddTitle" placeholder="Judul Event">
    <input type="datetime-local" id="eventAddStart">
    <input type="datetime-local" id="eventAddEnd">
    <textarea id="eventAddDesc" placeholder="Deskripsi"></textarea>
    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
      <button id="eventAddSaveBtn" onclick="saveNewEvent()">Simpan</button>
      <button onclick="closeModal('eventAddModal')">Batal</button>
    </div>
  </div>
</div>
<!-- === EVENT EDIT MODAL === -->
<div class="modal" id="eventEditModal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeModal('eventEditModal')">&times;</span>
    <h3 id="modalTitleEdit">Edit Event</h3>
    <input type="hidden" id="eventEditId">
    <input type="text" id="eventEditTitle" placeholder="Judul Event">
    <input type="datetime-local" id="eventEditStart">
    <input type="datetime-local" id="eventEditEnd">
    <textarea id="eventEditDesc" placeholder="Deskripsi"></textarea>
    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
      <button id="eventEditSaveBtn" onclick="saveEventEdit()">Simpan</button>
      <button id="eventEditDeleteBtn" onclick="deleteEvent()">Hapus</button>
    </div>
  </div>
</div>


  <div class="modal" id="fullArticleModal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeFullArticle()">&times;</span>
      <h3 id="fullArticleTitle"></h3>
      <p id="fullArticleBody"></p>
    </div>
  </div>

  

  <!-- Footer -->
  <div class="footer">
    &copy; 2025 ConsPIndo. All rights reserved.<br/>
    Trademark and design by <strong>MeribuCo</strong>
    <div class="footer-line"></div><br/>
  </div>

  <!-- Akhir halaman HTML sebelum </body> -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tabProfile = document.querySelector("#tab-profile");
    if (tabProfile) {
      tabProfile.addEventListener("click", function () {
        authPi(function (user) {
          const usernameEl = document.querySelector("#username");
          if (usernameEl) {
            usernameEl.innerText = user.user.username;
          }
        });
      });
    }
  });
</script>

 
<script src="main.js"></script>

</body>
</html>

